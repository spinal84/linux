#!/usr/bin/make -f

CONFIG = n900_defconfig
DTB    = omap3-n900.dtb
DEV    = n900
ARCH   = arm

ifneq (,$(filter parallel=%,$(DEB_BUILD_OPTIONS)))
	NUMJOBS = $(patsubst parallel=%,%,$(filter parallel=%,$(DEB_BUILD_OPTIONS)))
	BUILD_FLAGS += -j$(NUMJOBS)
endif

ifneq ($(DEB_BUILD_GNU_TYPE),$(DEB_TARGET_MULTIARCH))
	BUILD_FLAGS += CROSS_COMPILE=$(DEB_TARGET_MULTIARCH)-
endif

build:
	$(MAKE) ARCH=$(ARCH) $(CONFIG)
	$(MAKE) ARCH=$(ARCH) $(BUILD_FLAGS) zImage modules $(DTB)

binary-arch:
ifeq ($(DEB_BUILD_GNU_TYPE),$(DEB_TARGET_MULTIARCH))
	$(MAKE) ARCH=$(ARCH) DEV=$(DEV) DTB=$(DTB) $(BUILD_FLAGS) intdeb-pkg
else
	$(MAKE) ARCH=$(ARCH) $(BUILD_FLAGS) HOSTCC=$(DEB_TARGET_MULTIARCH)-gcc modules
	$(MAKE) ARCH=$(ARCH) DEV=$(DEV) DTB=$(DTB) $(BUILD_FLAGS) \
		HOSTCC=$(DEB_TARGET_MULTIARCH)-gcc intdeb-pkg
endif

clean:
	rm -rf debian/*tmp debian/files
	$(MAKE) mrproper

binary: binary-arch
